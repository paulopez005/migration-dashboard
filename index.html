<script>
/* ... keep everything above as-is ... */

renderSubsectionsView() {
  const filteredData = this.data.filter(row =>
    row.GOAL === this.selectedGoal &&
    row['SERVICE TYPE'] === this.selectedService &&
    row.SECTION === this.selectedSection
  );

  const subsections = this.groupBy(filteredData, 'SUBSECTION');

  let html = `
    <div class="flex items-center mb-6">
      <button onclick="DashboardApp.goBack()" class="mr-4 p-2 hover:bg-gray-100 rounded-lg transition-colors">
        <i data-lucide="arrow-left" class="w-5 h-5"></i>
      </button>
      <div>
        <h1 class="text-2xl font-bold text-gray-900">
          ${this.selectedGoal} - ${this.selectedService} - ${this.selectedSection}
        </h1>
        <p class="text-gray-600">Detailed task breakdown</p>
      </div>
    </div>
    <div class="space-y-4">
  `;

  Object.entries(subsections).forEach(([subsectionName, tasks]) => {
    const hasSubtasks = tasks.some(t => t['SUBSECTION TASK'] && t['SUBSECTION TASK'].trim() !== '');
    const isExpanded = !!this.expandedSubsections[subsectionName];
    const completed = tasks.filter(t => t.STATUS === 'Complete').length;
    const total = tasks.length;
    const percentage = total ? Math.round((completed / total) * 100) : 0;

    if (!hasSubtasks && tasks.length === 1) {
      const task = tasks[0];
      html += `
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm p-4 hover:bg-gray-50 transition-colors">
          <div class="flex items-center justify-between">
            <div class="flex-1">
              <h3 class="text-base font-medium text-gray-900">${subsectionName}</h3>
              <div class="flex flex-wrap gap-2 mt-2">
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getItemStatusColor(task.STATUS)}">
                  ${task.STATUS}
                </span>
                <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getImpactColor(task['MIGRATION IMPACT'])}">
                  ${task['MIGRATION IMPACT']}
                </span>
              </div>
            </div>
          </div>
        </div>
      `;
    } else {
      html += `
        <div class="bg-white rounded-lg border border-gray-200 shadow-sm">
          <div class="p-4 border-b border-gray-200 bg-gray-50 cursor-pointer hover:bg-gray-100 transition-colors"
               onclick="DashboardApp.toggleSubsection('${subsectionName.replace(/'/g, "\\'")}')">
            <div class="flex items-center justify-between">
              <div class="flex items-center gap-3">
                <i data-lucide="chevron-right" class="w-5 h-5 text-gray-500 transition-transform ${isExpanded ? 'rotate-90' : ''}"></i>
                <h3 class="text-lg font-semibold text-gray-900">${subsectionName}</h3>
              </div>
              <div class="flex items-center gap-4">
                <div class="flex items-center gap-2">
                  <div class="w-32 bg-gray-2 00 rounded-full h-2 overflow-hidden">
                    <div class="h-2 rounded-full ${this.getProgressBarColor(percentage)}" style="width:${percentage}%"></div>
                  </div>
                  <span class="text-sm font-medium text-gray-700">${percentage}%</span>
                </div>
                <span class="text-sm text-gray-600">${completed} / ${total} tasks</span>
              </div>
            </div>
          </div>
          ${isExpanded ? `
            <div class="divide-y divide-gray-200">
              ${tasks.map(task => `
                <div class="p-4 hover:bg-gray-50 transition-colors">
                  <div class="flex items-start justify-between">
                    <div class="flex-1">
                      ${task['SUBSECTION TASK'] && task['SUBSECTION TASK'].trim() !== '' ? `
                        <div class="font-medium text-gray-900 mb-2">${task['SUBSECTION TASK']}</div>
                      ` : ''}
                      <div class="flex flex-wrap gap-2">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getItemStatusColor(task.STATUS)}">
                          ${task.STATUS}
                        </span>
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium ${this.getImpactColor(task['MIGRATION IMPACT'])}">
                          ${task['MIGRATION IMPACT']}
                        </span>
                      </div>
                    </div>
                  </div>
                </div>
              `).join('')}
            </div>
          ` : ''}
        </div>
      `;
    }
  });

  html += `</div>`;
  return html;
},
/* ... keep everything below as-is ... */
</script>
